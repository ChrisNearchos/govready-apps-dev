id: issuepack
title: User Stories
instance-name: User Stories for {{jira_project_base_uri}}#{{jira_project_key}}
introduction:
  format: markdown
  template: |

    <style>
    .comic-strip-frame {
        /* positioning */
        position: relative; /* necessary for overflow: hidden */
        overflow: hidden; /* hide the comic-strip-frame-open panel when not hovering */
        margin: 15px 0; /* same as the bootstrap column gutter */

        /* frame outline */
        border: 1px solid #444;
        background-color: #777;
        border-radius: 10px;
        cursor: default;

        /* general text styles */
        font-family: Hind;
        line-height: 130%;
    }
        .comic-strip-frame-content {
            /* vertical centering */
            position: relative;
            top: 50%;
            transform: translate(0, -50%);
            -webkit-transform: translate(0, -50%); /* iOS still needs this */
        }
        .comic-strip-frame-closed {
            height: 100%; /* necessary for .comic-strip-frame-content vertical centering */

            /* text styles */
            text-align: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-transform: uppercase;
            text-shadow: 0.1em 0.1em 0.2em black;
        }
        .comic-strip-frame-open {
             /* start this content hidden *just above the top* of its parent */
            position: absolute;
            top: -100%;
            width: 100%;
            height: 100%;
            
            /* when un-hovering, return it to its original position */
            transition: top 1.5s;

            /* background/framing */
            background-color: rgba(20,70,40,.8);
            padding: 1em;

            /* text styles */
            font-size: 18px;
            font-weight: bold;
            color: white;
            text-shadow: 0.1em 0.1em 0.2em black;
        }
            /* :active is used for iOS --- see the script for activation by touchstart event */
            .comic-strip-frame:hover .comic-strip-frame-open, .comic-strip-frame:active .comic-strip-frame-open {
                /* animate the content to slide down so that it is directly over the parent */
                top: 0;
                transition: top .5s;
            }
            .comic-strip-frame-open .frame-caption {
                font-size: 23px;
                padding-bottom: 2px;
                border-bottom: 1px solid white;
            }
    </style>
    <style>
    .comic-strip-frame {
        /* the height must be tweaked to hold the content at any
           viewport width */
        height: 12em;

        background-image: url('/static/comic-frames-bg.png');
        background-size: 400%;
    }
        .comic-strip-frame.frame-0 {
            background-position: 0 0;
        }
        .comic-strip-frame.frame-1 {
            background-position: -100% 0;
        }
        .comic-strip-frame.frame-2 {
            background-position: -200% 0;
        }
        .comic-strip-frame.frame-3 {
            background-position: -300% 0;
        }
    </style>

    <script>
    /* iOS only activates :hover on elements that have click behavior.
       But more responsive is to use touchstart, rather than click, which
       activates :active. Here we add a function that makes everything
       touchable?? I'm not sure if we should restrict this just to the
       .comic-strip-frame elements, but this works. */
    document.addEventListener("touchstart", function() {}, false);
    </script>

    <div class="comic-strip-frames">
        <div class="row">
            <div class="col-xs-12">
                <div class="comic-strip-frame frame-0">
                    <div class="comic-strip-frame-closed">
                        <div class="comic-strip-frame-content">
                            What is agile?
                        </div>
                    </div>
                    <div class="comic-strip-frame-open">
                        <div class="comic-strip-frame-content">
                            <p class="frame-caption">Agile Development</p>
                            <p>Agile development is the story of your life. Agile development is the story of your life. Agile development is the story of your life.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="comic-strip-frame frame-1">
                    <div class="comic-strip-frame-closed">
                        <div class="comic-strip-frame-content">
                            Who does Agile?
                        </div>
                    </div>
                    <div class="comic-strip-frame-open">
                        <div class="comic-strip-frame-content">
                            <p class="frame-caption">Everyone can participate in agile</p>
                            Everyone can do agile. Adding security to agile will make you happier.
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="comic-strip-frame frame-2">
                    <div class="comic-strip-frame-closed">
                        <div class="comic-strip-frame-content">
                            How
                        </div>
                    </div>
                    <div class="comic-strip-frame-open">
                        <div class="comic-strip-frame-content">
                            This is the story of your life.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <div class="comic-strip-frame frame-3">
                    <div class="comic-strip-frame-closed">
                        <div class="comic-strip-frame-content">
                            Evidence
                        </div>
                    </div>
                    <div class="comic-strip-frame-open">
                        <div class="comic-strip-frame-content">
                            This is the story of your life.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    The best way to secure your system is during development.

    {{organization}} has prepared a set of security-related user stories for {{project}}'s product feature backlog.

    {% if match_jira_url(project.system_basics.issue_tracker) %}
    We already know your Jinja project is at {{match_jira_url(project.system_basics.issue_tracker).baseurl}}.
    {% endif %}

    Complete the following steps to automatically add these user stories to Jira.

external-functions:
  # This function is defined in issuepack.py.
  - match_jira_url

questions:
  - id: jira_project_base_uri
    title: Jira Project Base URI
    prompt: What is your Jira Project's base URI?
    type: url
    placeholder: https://myco.atlassian.net
    help: "Example: https://myco.atlassian.net"
    impute:
      - condition: match_jira_url(project.system_basics.issue_tracker) is not none
        value: match_jira_url(project.system_basics.issue_tracker).baseurl
        value-mode: expression

  - id: jira_project_key
    title: Jira Project Key
    prompt: What is your Jira Project Key at {{jira_project_base_uri}} (it prefixes all issues in project)?
    type: text
    impute:
      - condition: match_jira_url(project.system_basics.issue_tracker) is not none
        value: match_jira_url(project.system_basics.issue_tracker).key
        value-mode: expression

  - id: jira_username
    title: Jira Username
    prompt: What is your Jira username at {{jira_project_base_uri}}?
    type: text
    placeholder: username
    ask-first:
      - jira_project_key

  - id: jira_password
    title: Jira Password
    prompt: What is your Jira password for {{jira_username}} at {{jira_project_base_uri}}?
    type: password
    encrypt: emphemeral-user-key
    ask-first:
      - jira_project_key

  - id: create_issue_pack
    title: Create IssuePack
    prompt: Click Go to create the IssuePack.
    type: external-function
    function: create_issue_pack
    required: true # don't consider the module finished until this is run
    ask-first:
      - jira_project_base_uri
      - jira_project_key
      - jira_username
      - jira_password

output:
  - title: User Stories
    format: markdown
    template: |
      {% if not create_issue_pack %}
        The issues have not yet been created.
      {% elif create_issue_pack.status == "success" %}
        Congratulations, you've created user stories in Jira.
      {% else %}
        There was a problem creating the user stories. See the details for more information.
      {% endif %}

  - title: Details
    format: markdown
    template: |
      {% if create_issue_pack %}
      {{create_issue_pack.log}}
      {% endif %}


